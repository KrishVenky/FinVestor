{% extends 'layout.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2><i class="bi bi-calculator"></i> Portfolio Performance Summary (Aggregate Query)</h2>
  <a class="btn btn-outline-secondary" href="{{ url_for('reports.index') }}">Back to Reports</a>
</div>

<div class="alert alert-warning">
  <strong>Query Type:</strong> Aggregate Query - Uses GROUP BY with SUM, COUNT, AVG, and MAX aggregate functions
</div>

<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle mb-0">
        <thead class="table-dark">
          <tr>
            <th>Currency</th>
            <th>Risk Level</th>
            <th>Portfolio Count</th>
            <th>Total Transactions</th>
            <th>Total Invested</th>
            <th>Avg Transaction Value</th>
            <th>Max Transaction Value</th>
            <th>Total Commissions</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
          <tr>
            <td><strong>{{ r.currency }}</strong></td>
            <td><span class="badge bg-{% if r.risk_level == 'high' %}danger{% elif r.risk_level == 'medium' %}warning{% else %}success{% endif %}">{{ r.risk_level|title or 'N/A' }}</span></td>
            <td>{{ r.portfolio_count }}</td>
            <td>{{ r.total_transactions }}</td>
            <td><strong>${{ "%.2f"|format(r.total_invested) }}</strong></td>
            <td>${{ "%.2f"|format(r.avg_transaction_value) }}</td>
            <td>${{ "%.2f"|format(r.max_transaction_value) }}</td>
            <td>${{ "%.2f"|format(r.total_commissions) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="mt-3">
  <small class="text-muted">
    <strong>Aggregate Functions Used:</strong> COUNT (portfolios and transactions), SUM (total invested and commissions), AVG (average transaction value), MAX (maximum transaction value)
  </small>
</div>
{% endblock %}

