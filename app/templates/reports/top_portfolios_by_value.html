{% extends 'layout.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2><i class="bi bi-graph-up-arrow"></i> Top Portfolios by Value (Nested Query)</h2>
  <a class="btn btn-outline-secondary" href="{{ url_for('reports.index') }}">Back to Reports</a>
</div>

<div class="alert alert-success">
  <strong>Query Type:</strong> Nested Query - Uses subquery to find portfolios with total value above the average portfolio value
</div>

<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle mb-0">
        <thead class="table-dark">
          <tr>
            <th>Portfolio ID</th>
            <th>Portfolio Name</th>
            <th>Owner</th>
            <th>Currency</th>
            <th>Total Value</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
          <tr>
            <td>{{ r.portfolio_id }}</td>
            <td><strong>{{ r.portfolio_name }}</strong></td>
            <td>{{ r.owner_name }}</td>
            <td>{{ r.currency or 'N/A' }}</td>
            <td><strong class="text-success">${{ "%.2f"|format(r.total_value) }}</strong></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="mt-3">
  <small class="text-muted">
    <strong>Note:</strong> This report shows only portfolios whose total value exceeds the average portfolio value across all portfolios.
  </small>
</div>
{% endblock %}

